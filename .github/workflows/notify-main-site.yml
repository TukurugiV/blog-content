name: Notify Main Site of Content Updates

# ãƒ¡ã‚¤ãƒ³ãƒ–ãƒ©ãƒ³ãƒã¸ã®pushæ™‚ã«å®Ÿè¡Œ
on:
  push:
    branches: [ main ]
    paths:
      - 'blog/**'
      - 'news/**' 
      - 'events/**'
      - 'config/**'
      - 'images/**'

jobs:
  notify-main-site:
    runs-on: ubuntu-latest
    
    steps:
      - name: Notify main repository
        run: |
          echo "ğŸ”” Notifying main site repository about content updates..."
          
          # ãƒ¡ã‚¤ãƒ³ãƒªãƒã‚¸ãƒˆãƒªã«repository_dispatchã‚¤ãƒ™ãƒ³ãƒˆã‚’é€ä¿¡
          curl -X POST \
            -H "Accept: application/vnd.github.v3+json" \
            -H "Authorization: token ${{ secrets.MAIN_REPO_TOKEN }}" \
            https://api.github.com/repos/${{ secrets.MAIN_REPO_OWNER }}/${{ secrets.MAIN_REPO_NAME }}/dispatches \
            -d '{
              "event_type":"content-updated",
              "client_payload":{
                "repository":"${{ github.repository }}",
                "sha":"${{ github.sha }}",
                "ref":"${{ github.ref }}",
                "timestamp":"${{ github.event.head_commit.timestamp }}"
              }
            }'
            
      - name: Alternative webhook notification
        if: ${{ secrets.WEBHOOK_URL }}
        run: |
          echo "ğŸ“¡ Sending webhook notification..."
          curl -X POST "${{ secrets.WEBHOOK_URL }}" \
            -H "Content-Type: application/json" \
            -d '{
              "event": "content-updated",
              "repository": "${{ github.repository }}",
              "commit": "${{ github.sha }}",
              "message": "${{ github.event.head_commit.message }}",
              "timestamp": "${{ github.event.head_commit.timestamp }}"
            }'
      
      - name: Log completion
        run: |
          echo "âœ… Content update notification sent successfully!"
          echo "ğŸ“¦ Repository: ${{ github.repository }}"
          echo "ğŸ“ Commit: ${{ github.sha }}"
          echo "ğŸ’¬ Message: ${{ github.event.head_commit.message }}"